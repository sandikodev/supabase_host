# PostgreSQL example using Supabase
just cheatsheet or little snippet for supabase

## Supabase Init

1. login
   ```sh
   bunx supabase login
   ```
2. init
   ```sh
   bunx supabase init
   ```
3. link
   ```sh
   bunx supabase link --project [project_id]
   ```
4. pull
   ```sh
   bunx supabase db pull
   ```

## structure

| name     | generated by                                 |
| -------- | -------------------------------------------- |
| prisma   | `bunx prisma init`                           |
| types    | `bunx supabase gen types`                    |
| supabase | `bunx supabase init` or `bunx supabase link` |

## How to Work

1. working with bun\
   optional but we recomend you to use bun instead
   ```json
   // package.json
   "trustedDependencies": [
     "supabase"
   ]
   ```
2. generate types (prisma alternatives)\
   later will be consume by endpoint api
   ```sh
   mkdir types
   bunx supabase gen types typescript --project-id [project_id] --schema public > types/supabase.ts
   ```

## Self Hosted (Docker)

### Start Docker Service

- by executable supabase
  ```sh
  bunx supabase start
  ```
- by manual
  ```sh
  cd docker
  docker-compose -d
  ```

## ENV

### cp `env.example` to `.env.local`

```sh
# .env
# Connect to Supabase with PgBouncer.
# E.g consumes by prisma client in future
DATABASE_URL="postgres://postgres.[PROJECT_ID]:[PASSWORD]@aws-0-us-east-1.pooler.supabase.com:6543/postgres?pgbouncer=true"

# Direct connection to the database. Used for migrations.
# E.g for development usages
DIRECT_URL="postgresql://postgres:[PASSWORD]@db.[PROJECT_ID].supabase.co:5432/postgres"
```

### shadowing

```sh
# .env
 SHADOW_DATABASE_URL="postgres://postgres:[UR-PASSWORD]@db.[PROJECT_ID].supabase.co:5432/postgres_shadow"
```

optional but we recomend if you using hosted database

## Migration

Run the following command to create a migration file with the SQL necessary to create the database schema:

```
npx prisma migrate dev --name init
```

You should see the following output:

```
Your database is now in sync with your schema.
```
